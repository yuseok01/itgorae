<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>전시 정보</title>
  <style>
    /* 기본 스타일 */
    li {
      background-color: white;
      margin-bottom: 20px;
      border-radius: 10px;
      padding: 10px;
      border: 2px solid black; /* 검정색 둥근 테두리 */
    }

    /* 전시 종료 메시지 스타일 */
    .closed-message {
      color: red;
      font-weight: bold;
    }

    /* 가격이 0인 경우 노란색 배경 스타일 */
    .cheaper {
      background-color: yellow;
    }

    /* 관람 예정 전시 정보 상단 메시지 스타일 */
    .exhibition-info {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>다양한 전시 정보</h1>
    <label>
      <input type="checkbox" v-model="showAvailable" :disabled="!isposibleExhibition" /> 전시 중인 전시만 보기
    </label>
    <ul>
      <li v-for="item in filteredItems" :key="item.id" :class="{'cheaper': item.price === 0}">
        <!-- 전시 중인 경우 체크박스 활성화 -->
        <input type="checkbox" v-if="item.isposible === '전시 중'" :id="'exhibitionCheckbox' + item.id" @change="updateSelectedItems(item)" />
        <label v-if="item.isposible === '전시 중'" :for="'exhibitionCheckbox' + item.id">전시 관람하기</label>
        <h3>전시 제목: {{ item.name }}</h3>
        <p>가격: {{ formatPrice(item.price) }}</p>
        <!-- 전시 종료 메시지 표시 -->
        <p v-if="item.isposible === '전시 종료'" class="closed-message">해당 전시는 종료되었습니다.</p>
        <hr>
      </li>
    </ul>

    <!-- 관람 예정 전시 정보 상단 메시지 -->
    <p v-show="selected.length > 0" class="exhibition-info">
      관람 예정 전시회: {{ selected.map(item => item.name).join(', ') }} / 예상 금액: {{ totalprice.toLocaleString() }}원
    </p>
    <p v-show="selected.length === 0" class="exhibition-info">관람 예정 전시가 없습니다.</p>
  </div>
  
  <script src="https://unpkg.com/vue@3"></script>
  <script>
    const { createApp, ref, computed, watch } = Vue;

    const app = createApp({
      setup() {
        const id = ref(0);
        const items = ref([
          { id: id.value++, name: '무라카미 다카시 : 무라카시좀비', location: '부산 시립 미술관', price: 30000, isposible: '전시 중' },
          { id: id.value++, name: '미우라치오 카텔란 개인전', location: '리움 미술관', price: 30000, isposible: '전시 종료' },
          { id: id.value++, name: '조선백자전', location: '리움 미술관', price: 30000, isposible: '전시 종료' },
          { id: id.value++, name: '한국 실험미술 1960 - 1970', location: '국립현대미술관', price: 0, isposible: '전시 중' },
          { id: id.value++, name: '에드워드 호퍼 : 길 위에서', location: '서울 시립 미술관', price: 1000, isposible: '전시 종료' },
          { id: id.value++, name: '알렉산더 칼더 x 이우환', location: '국제갤러리 서울점', price: 15000, isposible: '전시 종료' }
        ]);

        const formatPrice = (price) => {
          if (!price || isNaN(price)) return "무료";
          return `${price.toLocaleString()}원`;
        };

        const showAvailable = ref(false);
        const selected = ref([]);
        let totalprice = ref(0);

        const filteredItems = computed(() => {
          if (showAvailable.value) {
            return items.value.filter(item => item.isposible === '전시 중');
          } else {
            return items.value;
          }
        });

        // 전시 중인 전시 체크박스 변경 시 선택된 전시 배열 업데이트
        const updateSelectedItems = (item) => {
          const index = selected.value.findIndex(selectedItem => selectedItem.id === item.id);
          if (index === -1) {
            selected.value.push(item);
          } else {
            selected.value.splice(index, 1);
          }
        };

        // 선택된 전시 배열의 가격 합산 업데이트
        watch(selected, () => {
          totalprice.value = selected.value.reduce((sum, item) => sum + item.price, 0);
        });

        // 전시 중인 전시가 있는지 확인하는 computed 속성
        const isposibleExhibition = computed(() => {
          return items.value.some(item => item.isposible === '전시 중');
        });

        return {
          items,
          formatPrice,
          showAvailable,
          filteredItems,
          selected,
          totalprice,
          isposibleExhibition,
          updateSelectedItems
        };
      }
    });

    app.mount('#app');
  </script>
</body>
</html>
